<div class="asesor-page-container">
  <h1 class="page-title">Lista de asesores</h1>

  <div class="asesores-grid">
    <div class="asesor-card" *ngFor="let asesor of asesores; let i = index">
      <div class="card-header">
        <div class="header-name-box">{{ asesor.nombre }}</div>
        <div class="profile-photo">
          <img
            [src]="asesor.imagenUrl"
            [alt]="'Foto de ' + asesor.nombre"
            (error)="onImageError($event)"
          />
        </div>
      </div>

      <div class="card-body">
        <p class="content-text question-text">
          {{ asesor.textoPrincipal }}
        </p>

        <button class="action-button" (click)="abrirModal(asesor)">
          Revisar
          <span class="material-icons-sharp">rate_review</span>
        </button>
      </div>
    </div>
  </div>

  <!-- BotÃ³n inferior -->
  <div class="reservas-container">
    <button class="reservas-button" (click)="abrirListaReservas()">Reservas</button>
  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarListaReservas">
  <div class="modal card-modal" style="max-width:1000px;">
    <button class="cerrar-modal" (click)="cerrarListaReservas()">Ã—</button>

    <h2 style="color:var(--color-dark-blue); margin-top:2px;">Reservas</h2>

    <div class="asesores-grid" style="margin-top:16px;">
      <div class="reserva-card" *ngFor="let item of reservasList">
        <div style="display:flex; gap:12px; align-items:flex-start;">
          <div style="width:86px; height:86px; border-radius:12px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center; border:6px solid #f6f0da;">
            <img [src]="item.imagenUrl" alt="{{item.nombre}}" style="width:100%; height:100%; object-fit:cover;" />
          </div>

          <div style="flex:1; text-align:left;">
            <h3 style="margin:0; font-size:1.45rem; font-weight:800;">{{ item.nombre }}</h3>
            <p style="margin:8px 0; color:#444; font-size:0.95rem;">
              {{ item.descripcion }}
            </p>

            <div style="margin-top:10px; border-top:1px solid #ddd; padding-top:10px;">
              <strong>Fechas reservadas</strong>
              <div style="margin-top:8px; color:#333; font-size:0.9rem;">
                <div *ngFor="let f of item.fechas">{{ f }}</div>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top:14px; display:flex; gap:12px; justify-content:center;">
          <button class="btn-primary" (click)="abrirReprogramar(item)">Reprogramar</button>
          <button class="btn-eliminar" (click)="eliminarReservaVisual(item)">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal-overlay" *ngIf="mostrarReprogramar">
  <div class="modal" style="width:420px;">
    <button class="cerrar-modal" (click)="cerrarReprogramar()">Ã—</button>
    <div class="modal-header">
      <div class="avatar-modal">{{ getIniciales(reprogramarTarget?.nombre || '') }}</div>
      <div>
        <h3>Horarios Disponibles para el Asesor</h3>
        <p class="descripcion-asesor">{{ reprogramarTarget?.nombre }}</p>
      </div>
    </div>

    <div style="margin-top:12px;">
      <label for="horarioSelect" style="display:block; margin-bottom:8px; font-weight:700;">Selecciona un horario</label>
      <select id="horarioSelect" [(ngModel)]="horarioSeleccionado" style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc;">
        <!-- SÃ³lo la opciÃ³n que pediste -->
        <option value="10-12">10 am - 12 pm</option>
      </select>

      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="btn-registrar" (click)="registrarReprogramacion()">Registrar</button>
        <button class="btn-ghost" (click)="cerrarReprogramar()">Cancelar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModal">
  <div class="modal">
    <button class="cerrar-modal" (click)="cerrarModal()">X</button>

    <div class="modal-header" *ngIf="asesorSeleccionado">
      <div class="avatar-modal">
        {{ getIniciales(asesorSeleccionado.nombre) }}
      </div>
      <div>
        <h3>{{ asesorSeleccionado.nombre }}</h3>
        <p class="descripcion-asesor">
          Hola, soy
          {{
            asesorSeleccionado.nombre
              ? asesorSeleccionado.nombre.split(' ')[0]
              : ''
          }}
          y tengo {{ asesorSeleccionado.experiencia }} aÃ±os de experiencia
        </p>
      </div>
    </div>

    <div class="form-reseÃ±a">
      <input
        type="number"
        placeholder="Da una calificaciÃ³n del 1 al 5"
        [(ngModel)]="nuevaResena.puntuacion"
        min="1"
        max="5"
      />
      <textarea
        placeholder="Escribir un comentario"
        [(ngModel)]="nuevaResena.comentario"
      ></textarea>
      <button class="btn-enviar" (click)="enviarResena()">Enviar</button>
    </div>

    <div class="reseÃ±as-previas" *ngIf="asesorSeleccionado">
      <div
        class="reseÃ±a-item"
        *ngFor="let r of resenas[asesorSeleccionado.id]"
      >
        <div class="avatar-mini">{{ getIniciales(r.nombreCliente || 'C') }}</div>
        <div>
          <strong>{{ r.nombreCliente }}</strong>
          <span class="estrellas">{{ 'â˜…'.repeat(r.puntuacion) }}</span>
          <p>{{ r.comentario }}</p>
        </div>
      </div>
    </div>

    <button class="btn-reservar" (click)="abrirReserva(asesorSeleccionado)">
      Reservar
    </button>
  </div>
</div>

<!-- MODAL CALENDARIO / RESERVAS (tu cÃ³digo existente, sin cambios funcionales) -->
<div class="modal-overlay" *ngIf="mostrarReservaModal">
  <div class="modal card-modal">
    <button class="cerrar-modal" (click)="cerrarReservaModal()">X</button>

    <h3 style="color:var(--color-dark-blue); margin-top: 6px;">Calendario</h3>

    <div class="calendar-container">
      <!-- calendario izquierdo -->
      <div class="calendar">
        <div class="month-header">
          <div class="month-nav">
            <button (click)="prevMonth()">&lt;</button>
          </div>
          <div class="month-title">
            {{ monthNames[currentMonth] }} {{ currentYear }}
          </div>
          <div class="month-nav">
            <button (click)="nextMonth()">&gt;</button>
          </div>
        </div>

        <div class="weekdays">
          <div *ngFor="let wd of weekDays">{{ wd }}</div>
        </div>

        <div class="days-grid">
          <div
            *ngFor="let day of calendarDays"
            [class.day]="true"
            [class.inactive]="!day.inCurrentMonth"
            [class.selected]="isSelected(day)"
            [class.today]="isToday(day)"
            (click)="selectDay(day)"
          >
            {{ day.date.getDate() }}
          </div>
        </div>

        <div style="margin-top: 12px; display:flex; gap:8px;">
          <input type="text" [value]="inputMonthYear" readonly style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;"/>
          <button class="btn-ghost" (click)="goToToday()">Hoy</button>
        </div>
      </div>

      <!-- panel derecho -->
      <div class="calendar-right">
        <h4>DÃ­a y hora seleccionada</h4>

        <div class="selected-info">
          <div *ngIf="selectedDateStr; else noSelection">
            <div style="font-weight:700; margin-bottom:6px;">-- {{ selectedDateStr }} --</div>
            <div style="color:#777; margin-bottom:8px;">-- {{ asesorReserva?.nombre }} --</div>

            <div *ngIf="availableSlots.length">
              <div *ngFor="let s of availableSlots" class="slot-box">
                <div class="slot-pill">{{ s.label }}</div>
                <div>
                  <button class="btn-primary" (click)="registrarSlot(s)">Registrar</button>
                </div>
              </div>
            </div>

            <div class="reserved-list">
              <div *ngFor="let r of getReservasForAsesor(asesorReserva?.id)" class="reserved-item">
                <div>
                  â€¢ Cita con {{ asesorReserva?.nombre }}<br/>
                  <small>{{ r.fecha }} â€” {{ r.horaInicio }} - {{ r.horaFin }}</small>
                </div>
                <div style="display:flex; gap:8px; align-items:center;">
                  <button class="btn-ghost" (click)="openCardModal(r)">+</button>
                  <button class="btn-ghost" (click)="eliminarReserva(asesorReserva?.id, r)">ðŸ—‘</button>
                </div>
              </div>
            </div>

            <div style="margin-top: 12px;">
              <button class="btn-primary" (click)="openCardModal()" [disabled]="!hasAnyReservaForSelectedDate()">Seleccionar tarjeta</button>
            </div>
          </div>

          <ng-template #noSelection>
            <div style="color:#666;">-- Selecciona un dÃ­a a la izquierda --</div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL TARJETA / PAGO -->
<div class="modal-overlay" *ngIf="mostrarCardModal">
  <div class="modal card-modal">
    <button class="cerrar-modal" (click)="cerrarCardModal()">X</button>
    <h4>Seleccionar tarjetas registradas</h4>

    <div style="margin-top:10px;">
      <select style="width:100%; padding:8px; border-radius:8px; border:1px solid #ccc;" [(ngModel)]="selectedCard">
        <option [ngValue]="null">Seleccione tarjeta...</option>
        <option [value]="'visa-46'">Mi visa que termina en **46</option>
      </select>
    </div>

    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn-primary" (click)="confirmarPago()" [disabled]="!selectedCard">Pagar</button>
      <button class="btn-ghost" (click)="cerrarCardModal()">Cancelar</button>
    </div>
  </div>
</div>
